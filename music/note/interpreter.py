import re
from typing import Dict, Set, Union

from ...const_singleton import ConstSingleton

from .language import Language
from .note import Note
from .exceptions import NotFoundNoteError, NotFoundNoteLanguageError


class _Data(ConstSingleton):

    LanguageStrDict: Dict[str, Language] = {
        "": Language.MIDI,
        "MIDI": Language.MIDI,
        "MID": Language.MIDI,

        "English": Language.English,
        "eng": Language.English,
        "en": Language.English,
        "us": Language.English,

        "Italian": Language.Italian,
        "Italy": Language.Italian,
        "ita": Language.Italian,
        "it": Language.Italian,
        "Latin": Language.Italian,
        "lat": Language.Italian,
        "la": Language.Italian,
        "Italia": Language.Italian,
        "Italiano": Language.Italian,
        "Romance": Language.Italian,
        "DoReMi": Language.Italian,

        "German": Language.German,
        "Germany": Language.German,
        "ger": Language.German,
        "deu": Language.German,
        "de": Language.German,
        "Deutschland": Language.German,
        "Deutsch": Language.German,

        "Japanese": Language.Japanese,
        "Japan": Language.Japanese,
        "jpn": Language.Japanese,
        "jp": Language.Japanese,
        "ja": Language.Japanese,
        "ã‚¤ãƒ­ãƒ": Language.Japanese,

        "Dutch": Language.Dutch,

        "Byzantine": Language.Byzantine,

        "Indian": Language.Indian,

        "æ—¥æœ¬èªž": Language.ItalianInKana,
        "æ—¥æœ¬": Language.ItalianInKana,
        "æ—¥": Language.ItalianInKana,

        "ItalianInKana": Language.ItalianInKana,
        "ãƒ‰ãƒ¬ãƒŸ": Language.ItalianInKana,
        "ã‚«ãƒŠ": Language.ItalianInKana,

        "JapaneseInRoman": Language.JapaneseInRoman,
        "Iroha": Language.JapaneseInRoman,

        "Chromatic": Language.Chromatic,
        "Siler": Language.Chromatic,

        "FixedDoInRoman": Language.FixedDoInRoman,
        "FixedDo": Language.FixedDoInRoman,
        "Fixed-do": Language.FixedDoInRoman,

        "FixedDoInKana": Language.FixedDoInKana,
        "å›ºå®šãƒ‰": Language.FixedDoInKana,
    }

    NoteNameDict: Dict[Language, Dict[str, Note]] = {
        Language.MIDI: {
            "Cb": Note.B,
            "C": Note.C,
            "C#": Note.C_SHARP,
            "Db": Note.C_SHARP,
            "D": Note.D,
            "D#": Note.D_SHARP,
            "Eb": Note.D_SHARP,
            "E": Note.E,
            "E#": Note.F,
            "Fb": Note.E,
            "F": Note.F,
            "F#": Note.F_SHARP,
            "Gb": Note.F_SHARP,
            "G": Note.G,
            "G#": Note.G_SHARP,
            "Ab": Note.G_SHARP,
            "A": Note.A,
            "A#": Note.A_SHARP,
            "Bb": Note.A_SHARP,
            "B": Note.B,
            "B#": Note.C,
        },
        Language.English: {
            "Dobb": Note.A_SHARP,
            "Dob": Note.B,
            "Do": Note.C,
            "Do#": Note.C_SHARP,
            "Do##": Note.D,
            "Rebb": Note.C,
            "Reb": Note.C_SHARP,
            "Re": Note.D,
            "Re#": Note.D_SHARP,
            "Re##": Note.E,
            "Mibb": Note.D,
            "Mib": Note.D_SHARP,
            "Mi": Note.E,
            "Mi#": Note.F,
            "Mi##": Note.F_SHARP,
            "Fabb": Note.D_SHARP,
            "Fab": Note.E,
            "Fa": Note.F,
            "Fa#": Note.F_SHARP,
            "Fa##": Note.G,
            "Solbb": Note.F,
            "Solb": Note.F_SHARP,
            "Sol": Note.G,
            "Sol#": Note.G_SHARP,
            "Sol##": Note.A,
            "Labb": Note.G,
            "Lab": Note.G_SHARP,
            "La": Note.A,
            "La#": Note.A_SHARP,
            "La##": Note.B,
            "Tibb": Note.A,
            "Tib": Note.A_SHARP,
            "Ti": Note.B,
            "Ti#": Note.C,
            "Ti##": Note.C_SHARP,
        },
        Language.Italian: {
            "Dobb": Note.A_SHARP,
            "Dob": Note.B,
            "Do": Note.C,
            "Do#": Note.C_SHARP,
            "Do##": Note.D,
            "Rebb": Note.C,
            "Reb": Note.C_SHARP,
            "Re": Note.D,
            "Re#": Note.D_SHARP,
            "Re##": Note.E,
            "Mibb": Note.D,
            "Mib": Note.D_SHARP,
            "Mi": Note.E,
            "Mi#": Note.F,
            "Mi##": Note.F_SHARP,
            "Fabb": Note.D_SHARP,
            "Fab": Note.E,
            "Fa": Note.F,
            "Fa#": Note.F_SHARP,
            "Fa##": Note.G,
            "Solbb": Note.F,
            "Solb": Note.F_SHARP,
            "Sol": Note.G,
            "Sol#": Note.G_SHARP,
            "Sol##": Note.A,
            "Labb": Note.G,
            "Lab": Note.G_SHARP,
            "La": Note.A,
            "La#": Note.A_SHARP,
            "La##": Note.B,
            "Sibb": Note.A,
            "Sib": Note.A_SHARP,
            "Si": Note.B,
            "Si#": Note.C,
            "Si##": Note.C_SHARP,
        },
        Language.German: {
            "Ceses": Note.A_SHARP,
            "Ces": Note.B,
            "C": Note.C,
            "Cis": Note.C_SHARP,
            "Cisis": Note.D,
            "Deses": Note.C,
            "Des": Note.C_SHARP,
            "D": Note.D,
            "Dis": Note.D_SHARP,
            "Disis": Note.E,
            "Eses": Note.D,
            "Es": Note.D_SHARP,
            "E": Note.E,
            "Eis": Note.F,
            "Eisis": Note.F_SHARP,
            "Feses": Note.D_SHARP,
            "Fes": Note.E,
            "F": Note.F,
            "Fis": Note.F_SHARP,
            "Fisis": Note.G,
            "Geses": Note.F,
            "Ges": Note.F_SHARP,
            "G": Note.G,
            "Gis": Note.G_SHARP,
            "Gisis": Note.A,
            "Asas": Note.G,
            "Ases": Note.G,
            "As": Note.G_SHARP,
            "A": Note.A,
            "Ais": Note.A_SHARP,
            "Aisis": Note.B,
            "Heses": Note.A,
            "Bes": Note.A,
            "BB": Note.A,
            "B": Note.A_SHARP,
            "Hes": Note.A_SHARP,
            "H": Note.B,
            "His": Note.C,
            "Hisis": Note.C_SHARP,
        },
        Language.Japanese: {
            "é‡å¤‰ãƒ": Note.A_SHARP,
            "å¤‰ãƒ": Note.B,
            "ãƒ": Note.C,
            "å¬°ãƒ": Note.C_SHARP,
            "é‡å¬°ãƒ": Note.D,
            "é‡å¤‰ãƒ‹": Note.C,
            "å¤‰ãƒ‹": Note.C_SHARP,
            "ãƒ‹": Note.D,
            "å¬°ãƒ‹": Note.D_SHARP,
            "é‡å¬°ãƒ‹": Note.E,
            "é‡å¤‰ãƒ›": Note.D,
            "å¤‰ãƒ›": Note.D_SHARP,
            "ãƒ›": Note.E,
            "å¬°ãƒ›": Note.F,
            "é‡å¬°ãƒ›": Note.F_SHARP,
            "é‡å¤‰ãƒ˜": Note.D_SHARP,
            "å¤‰ãƒ˜": Note.E,
            "ãƒ˜": Note.F,
            "å¬°ãƒ˜": Note.F_SHARP,
            "é‡å¬°ãƒ˜": Note.G,
            "é‡å¤‰ãƒˆ": Note.F,
            "å¤‰ãƒˆ": Note.F_SHARP,
            "ãƒˆ": Note.G,
            "å¬°ãƒˆ": Note.G_SHARP,
            "é‡å¬°ãƒˆ": Note.A,
            "é‡å¤‰ã‚¤": Note.G,
            "å¤‰ã‚¤": Note.G_SHARP,
            "ã‚¤": Note.A,
            "å¬°ã‚¤": Note.A_SHARP,
            "é‡å¬°ã‚¤": Note.B,
            "é‡å¤‰ãƒ­": Note.A,
            "å¤‰ãƒ­": Note.A_SHARP,
            "ãƒ­": Note.B,
            "å¬°ãƒ­": Note.C,
            "é‡å¬°ãƒ­": Note.C_SHARP,
        },

        Language.Dutch: {
            "Ceses": Note.A_SHARP,
            "Ces": Note.B,
            "C": Note.C,
            "Cis": Note.C_SHARP,
            "Cisis": Note.D,
            "Deses": Note.C,
            "Des": Note.C_SHARP,
            "D": Note.D,
            "Dis": Note.D_SHARP,
            "Disis": Note.E,
            "Eses": Note.D,
            "Es": Note.D_SHARP,
            "E": Note.E,
            "Eis": Note.F,
            "Eisis": Note.F_SHARP,
            "Feses": Note.D_SHARP,
            "Fes": Note.E,
            "F": Note.F,
            "Fis": Note.F_SHARP,
            "Fisis": Note.G,
            "Geses": Note.F,
            "Ges": Note.F_SHARP,
            "G": Note.G,
            "Gis": Note.G_SHARP,
            "Gisis": Note.A,
            "Asas": Note.G,
            "Ases": Note.G,
            "As": Note.G_SHARP,
            "A": Note.A,
            "Ais": Note.A_SHARP,
            "Aisis": Note.B,
            "Beses": Note.A,
            "Bes": Note.A_SHARP,
            "B": Note.B,
            "Bis": Note.C,
            "Bisis": Note.C_SHARP,
        },
        Language.Byzantine: {
            "Nibb": Note.A_SHARP,
            "Nib": Note.B,
            "Ni": Note.C,
            "Ni#": Note.C_SHARP,
            "Ni##": Note.D,
            "Pabb": Note.C,
            "Pab": Note.C_SHARP,
            "Pa": Note.D,
            "Pa#": Note.D_SHARP,
            "Pa##": Note.E,
            "Vubb": Note.D,
            "Vub": Note.D_SHARP,
            "Vu": Note.E,
            "Vu#": Note.F,
            "Vu##": Note.F_SHARP,
            "Gabb": Note.D_SHARP,
            "Gab": Note.E,
            "Ga": Note.F,
            "Ga#": Note.F_SHARP,
            "Ga##": Note.G,
            "Dibb": Note.F,
            "Dib": Note.F_SHARP,
            "Di": Note.G,
            "Di#": Note.G_SHARP,
            "Di##": Note.A,
            "Kebb": Note.G,
            "Keb": Note.G_SHARP,
            "Ke": Note.A,
            "Ke#": Note.A_SHARP,
            "Ke##": Note.B,
            "Zobb": Note.A,
            "Zob": Note.A_SHARP,
            "Zo": Note.B,
            "Zo#": Note.C,
            "Zo##": Note.C_SHARP,
        },
        Language.Indian: {
            "Sabb": Note.A_SHARP,
            "Sab": Note.B,
            "Sa": Note.C,
            "Sa#": Note.C_SHARP,
            "Sa##": Note.D,
            "Rebb": Note.C,
            "Reb": Note.C_SHARP,
            "Re": Note.D,
            "Re#": Note.D_SHARP,
            "Re##": Note.E,
            "Gabb": Note.D,
            "Gab": Note.D_SHARP,
            "Ga": Note.E,
            "Ga#": Note.F,
            "Ga##": Note.F_SHARP,
            "Mabb": Note.D_SHARP,
            "Mab": Note.E,
            "Ma": Note.F,
            "Ma#": Note.F_SHARP,
            "Ma##": Note.G,
            "Pabb": Note.F,
            "Pab": Note.F_SHARP,
            "Pa": Note.G,
            "Pa#": Note.G_SHARP,
            "Pa##": Note.A,
            "Dhabb": Note.G,
            "Dhab": Note.G_SHARP,
            "Dha": Note.A,
            "Dha#": Note.A_SHARP,
            "Dha##": Note.B,
            "Nibb": Note.A,
            "Nib": Note.A_SHARP,
            "Ni": Note.B,
            "Ni#": Note.C,
            "Ni##": Note.C_SHARP,
        },

        Language.ItalianInKana: {
            "ãƒ‰bb": Note.A_SHARP,
            "ãƒ‰b": Note.B,
            "ãƒ‰": Note.C,
            "ãƒ‰#": Note.C_SHARP,
            "ãƒ‰##": Note.D,
            "ãƒ¬bb": Note.C,
            "ãƒ¬b": Note.C_SHARP,
            "ãƒ¬": Note.D,
            "ãƒ¬#": Note.D_SHARP,
            "ãƒ¬##": Note.E,
            "ãƒŸbb": Note.D,
            "ãƒŸb": Note.D_SHARP,
            "ãƒŸ": Note.E,
            "ãƒŸ#": Note.F,
            "ãƒŸ##": Note.F_SHARP,
            "ãƒ•ã‚¡bb": Note.D_SHARP,
            "ãƒ•ã‚¡b": Note.E,
            "ãƒ•ã‚¡": Note.F,
            "ãƒ•ã‚¡#": Note.F_SHARP,
            "ãƒ•ã‚¡##": Note.G,
            "ã‚½bb": Note.F,
            "ã‚½b": Note.F_SHARP,
            "ã‚½": Note.G,
            "ã‚½#": Note.G_SHARP,
            "ã‚½##": Note.A,
            "ãƒ©bb": Note.G,
            "ãƒ©b": Note.G_SHARP,
            "ãƒ©": Note.A,
            "ãƒ©#": Note.A_SHARP,
            "ãƒ©##": Note.B,
            "ã‚·bb": Note.A,
            "ã‚·b": Note.A_SHARP,
            "ã‚·": Note.B,
            "ã‚·#": Note.C,
            "ã‚·##": Note.C_SHARP,
        },
        Language.JapaneseInRoman: {
            "JuuhenHa": Note.A_SHARP,
            "HenHa": Note.B,
            "Ha": Note.C,
            "EiHa": Note.C_SHARP,
            "JuueiHa": Note.D,
            "JuuhenNi": Note.C,
            "HenNi": Note.C_SHARP,
            "Ni": Note.D,
            "EiNi": Note.D_SHARP,
            "JuueiNi": Note.E,
            "JuuhenHo": Note.D,
            "HenHo": Note.D_SHARP,
            "Ho": Note.E,
            "EiHo": Note.F,
            "JuueiHo": Note.F_SHARP,
            "JuuhenHe": Note.D_SHARP,
            "HenHe": Note.E,
            "He": Note.F,
            "EiHe": Note.F_SHARP,
            "JuueiHe": Note.G,
            "JuuhenTo": Note.F,
            "HenTo": Note.F_SHARP,
            "To": Note.G,
            "EiTo": Note.G_SHARP,
            "JuueiTo": Note.A,
            "JuuhenI": Note.G,
            "HenI": Note.G_SHARP,
            "I": Note.A,
            "EiI": Note.A_SHARP,
            "JuueiI": Note.B,
            "JuuhenRo": Note.A,
            "HenRo": Note.A_SHARP,
            "Ro": Note.B,
            "EiRo": Note.C,
            "JuueiRo": Note.C_SHARP,
        },

        Language.Chromatic: {
            "Du": Note.A_SHARP,
            "Do": Note.B,
            "Da": Note.C,
            "De": Note.C_SHARP,
            "Di": Note.D,
            "Ru": Note.C,
            "Ro": Note.C_SHARP,
            "Ra": Note.D,
            "Re": Note.D_SHARP,
            "Ri": Note.E,
            "Mu": Note.D,
            "Mo": Note.D_SHARP,
            "Ma": Note.E,
            "Me": Note.F,
            "Mi": Note.F_SHARP,
            "Fu": Note.D_SHARP,
            "Fo": Note.E,
            "Fa": Note.F,
            "Fe": Note.F_SHARP,
            "Fi": Note.G,
            "Su": Note.F,
            "So": Note.F_SHARP,
            "Sa": Note.G,
            "Se": Note.G_SHARP,
            "Si": Note.A,
            "Lu": Note.G,
            "Lo": Note.G_SHARP,
            "La": Note.A,
            "Le": Note.A_SHARP,
            "Li": Note.B,
            "Tu": Note.A,
            "To": Note.A_SHARP,
            "Ta": Note.B,
            "Te": Note.C,
            "Ti": Note.C_SHARP,
        },
        Language.FixedDoInRoman: {
            "Do": Note.C,
            "Di": Note.C_SHARP,
            "Ra": Note.C_SHARP,
            "Re": Note.D,
            "Ri": Note.D_SHARP,
            "Me": Note.D_SHARP,
            "Ma": Note.D_SHARP,
            "Mi": Note.E,
            "Fa": Note.F,
            "Fi": Note.F_SHARP,
            "Se": Note.F_SHARP,
            "Sol": Note.G,
            "Si": Note.G_SHARP,
            "Le": Note.G_SHARP,
            "Lo": Note.G_SHARP,
            "La": Note.A,
            "Li": Note.A_SHARP,
            "Te": Note.A_SHARP,
            "Ta": Note.A_SHARP,
            "Ti": Note.B,
        },
        Language.FixedDoInKana: {
            "ãƒ‰": Note.C,
            "ãƒ‡": Note.C_SHARP,
            "ãƒ¬": Note.D,
            "ãƒª": Note.D_SHARP,
            "ãƒŸ": Note.E,
            "ãƒ•ã‚¡": Note.F,
            "ãƒ•ã‚£": Note.F_SHARP,
            "ã‚½": Note.G,
            "ã‚µ": Note.G_SHARP,
            "ãƒ©": Note.A,
            "ãƒ": Note.A_SHARP,
            "ã‚·": Note.B,
        },
    }

    AccidentalDict: Dict[Language, Dict[str, Set[str]]] = {
        Language.Unknown: {
            "": {"-", "_", ":", ",", ".", "@", "â™®", },
            "#": {"â™¯", "ï¼ƒ", "sharp", },
            "b": {"â™­", "flat", },
            "##": {chr(0x1d12a), },
            "bb": {chr(0x1d12b), },
            # "##": {"ð„ª", },
            # "bb": {"ð„«", },
        },

        Language.English: {
            "": {"natural", },
            "##": {"doublesharp", },
            "bb": {"doubleflat", },
        },
        Language.Italian: {
            "": {"bequadro", "biquadro", "biqquadro", "beqquadro", },
            "#": {"diesis", },
            "b": {"bemolle", },
            "##": {"doppiodiesis", },
            "bb": {"doppiobemolle", },
        },
        Language.German: {
            "": {},
            "#": {},
            "b": {},
            "##": {},
            "bb": {},
        },
        Language.Japanese: {
            "": {"æœ¬ä½", "ã»ã‚“ã„", },
            "å¬°": {"ãˆã„", },
            "å¤‰": {"ã¸ã‚“", },
            "é‡": {"ã˜ã‚…ã†", },
        },

        Language.Dutch: {
            "": {"auflÃ¶sungszeichen", "auflosungszeichen", },
            "#": {"kreuz", },
            "b": {},
            "##": {"doppelkreuz", },
            "bb": {"doppelb", },
        },
        Language.Byzantine: {
            "": {},
            "#": {"diesis", },
            "b": {"hyphesis", },
            "##": {},
            "bb": {},
        },
        Language.Indian: {
            "": {},
            "#": {"tivra", },
            "b": {"komal", },
            "##": {},
            "bb": {},
        },

        Language.ItalianInKana: {
            "": {"ãƒŠãƒãƒ¥ãƒ©ãƒ«", },
            "#": {"ã‚·ãƒ£ãƒ¼ãƒ—", },
            "b": {"ãƒ•ãƒ©ãƒƒãƒˆ", },
            "##": {"ãƒ€ãƒ–ãƒ«ã‚·ãƒ£ãƒ¼ãƒ—", },
            "bb": {"ãƒ€ãƒ–ãƒ«ãƒ•ãƒ©ãƒƒãƒˆ", },
        },
        Language.JapaneseInRoman: {
            "": {"honi", "æœ¬ä½", "ã»ã‚“ã„", },
            "ei": {"å¬°", "ãˆã„", },
            "hen": {"å¤‰", "ã¸ã‚“", },
            "juu": {"é‡", "ã˜ã‚…ã†", },
        },

        Language.Chromatic: {},
        Language.FixedDoInRoman: {},
        Language.FixedDoInKana: {},
    }


DATA: _Data = _Data.get_instance()


class Interpreter:

    # region Class Method

    @classmethod
    def get_language(cls, language: Union[str, Language]) -> Language:
        if type(language) == Language:
            return language
        return Interpreter.get_language_from_str(language)

    @classmethod
    def get_language_from_str(cls, language: str) -> Language:
        for k, l in DATA.LanguageStrDict.items():
            if k.lower() == language.lower():
                return l
        raise NotFoundNoteLanguageError

    @classmethod
    def get_dict(cls, language: Union[str, Language]) -> Dict[str, Note]:
        return DATA.NoteNameDict[Interpreter.get_language(language)]

    @classmethod
    def to_note(cls, value: str, language: Union[str, Language]) -> Note:
        value = value.lower()
        value = re.sub(r"[\s]", "", value)
        value = Interpreter._replace_accidental_strs(value, language)
        for k, n in Interpreter.get_dict(language).items():
            if k.lower() == value:
                return n
        raise NotFoundNoteError

    # endregion

    # region Private Class Method

    @classmethod
    def _replace_accidental_strs(cls, value: str, language: Union[str, Language]) -> str:
        language: Language = Interpreter.get_language(language)
        value = Interpreter._replace_accidental_strs_from_dict(value, DATA.AccidentalDict[Language.Unknown])
        if language in DATA.AccidentalDict:
            value = Interpreter._replace_accidental_strs_from_dict(value, DATA.AccidentalDict[language])
        return value

    @classmethod
    def _replace_accidental_strs_from_dict(cls, value: str, replaced_dict: Dict[str, Set[str]]) -> str:
        for (new, old_list) in replaced_dict.items():
            for old in old_list:
                value = value.replace(old, new)
        return value

    # endregion
